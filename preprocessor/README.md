# Z Open Editor Preprocessor sample

To be able to use the Preprocessor support and this example you need to have imported a valid trial or license key in the Welcome page that activies this feature.

This folder provides a trivial COBOL Preprocessor example written in Java that you can use to try the Z Open Editor preprocessor support. Once you were able to run our sample you should be able to use your own preprocessor in a similar way by replacing the command line and parameters in the ZAPP files.

## Prepare the sample preprocessor program

To use the sample preprocessor you need to build it using Java. The folder [preprocessor/my-preprocessor](./my-preprocessor/) contains a Java Maven project that you can use to build it by running `mvn package` from that folder. Altenatively, use the [Extension Pack for Java](https://marketplace.visualstudio.com/items?itemName=vscjava.vscode-java-pack) to build it from VS Code (Java and Maven required in your path).

## Review the ZAPP file and create ZAPP user or workspace variables

Open this samples [ZAPP file](../zapp.yaml) and find the `preprocessor` profile define in there. It references two variables for executing the preprocessor: `${JAVA_HOME}` and `${WORKSPACE}`. You find placeholders for these two in this [samples workspace settings file](../.vscode/settings.json). Open that file and replace the two values with your absolute `$JAVA_HOME` path and the absolute path of this workspace, i.e. where you cloned this Git repository on your development machine.

Also note the location of the `outputPath` setting in the profile pointing to the directory [preprocessor/output](./output/). This is the folder were the preprocessed programs will be generated in.

## Running the preprocessor from Z Open Editor

Now you are ready to run the preprocessor on a sample program. Open the file [preprocessor/COBOL/PrintApp.cbl](./COBOL/PrintApp.cbl). You will see that Z Open Editor will show many syntax errors as it contains macros such as `+ID`, `+DD`, etc. The sample preprocessor will replace them with valid COBOL code.

Right-click inside the editor and select "Execute local preprocessor command".

A progress bar will open and as a result all the syntax errors will go away. You can now hover over the preprocessor macros and see the code that has been used to replace them in a hover. For example the `+ID.` statement will show in the hover that it was replaced with `IDENTIFICATION DIVISION.`.

Open the generated output file [preprocessor/output/PrintApp.cee](./output/PrintApp.cee) in the editor. You see the file generated by the preprocessor, which is a valid COBOL program. The Z Open Editor language server will use that program file to parse for errors and overlay the results to the original programs with macros in the editor.

Go back to [preprocessor/COBOL/PrintApp.cbl](./COBOL/PrintApp.cbl) and select "Compare preprocessor input and putput files" from the context menu. It will of a Diff editor showing you the two files and their differences side by side.
